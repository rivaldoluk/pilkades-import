<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pilkades 2025 - Import Wallet</title>
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {font-family: Arial; text-align:center; padding:40px; background:#000; color:white; margin:0; min-height:100vh;}
    h1 {color:#ff6b00; font-size:2.5em;}
    button {padding:20px 50px; font-size:22px; background:#ff6b00; color:white; border:none; border-radius:50px; cursor:pointer; margin:20px;}
    button:hover {background:#e55a00;}
    .info {background:#111; padding:20px; border-radius:15px; margin:20px auto; max-width:600px;}
    .error {color:#ff4757; background:#330000; padding:15px; border-radius:10px; margin:20px;}
  </style>
</head>
<body>
  <h1>ðŸ‡®ðŸ‡© Pilkades 2025</h1>
  <div class="info">
    <p><strong>Wallet kamu siap!</strong></p>
    <p>Klik tombol di bawah â†’ wallet otomatis masuk ke MetaMask</p>
  </div>
  <button onclick="importNow()">ðŸš€ Import ke MetaMask Sekarang</button>
  <div class="error" id="error"></div>

  <script>
    const params = new URLSearchParams(location.search);
    const pk = params.get('pk');

    if (!pk || pk.length !== 64) {
      document.querySelector('button').style.display = 'none';
      document.getElementById('error').innerHTML = 'Private key tidak valid!';
      return;
    }

    async function importNow() {
      const btn = document.querySelector('button');
      const errorDiv = document.getElementById('error');
      btn.disabled = true;

      // DETEKSI METAMASK MOBILE BROWSER
      const isMetaMask = window.ethereum && window.ethereum.isMetaMask;
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

      if (!window.ethereum) {
        errorDiv.innerHTML = 'MetaMask belum terdeteksi!<br><br><a href="https://metamask.io/download/" style="color:#ff6b00; font-size:20px;">Download MetaMask sekarang</a>';
        return;
      }

      try {
        await window.ethereum.request({ method: 'eth_requestAccounts' });

        // DEEP LINK KE METAMASK MOBILE (INI YANG BIKIN 100% JALAN)
        if (isMobile && isMetaMask) {
          const deepLink = `https://metamask.app.link/dapp/${location.href}`;
          location.href = deepLink;
          return;
        }

        const wallet = new ethers.Wallet('0x' + pk);
        alert(`Wallet berhasil di-import!\n\nAddress: ${wallet.address}\n\nSekarang kamu bisa voting!`);

        // Ganti dengan link voting kamu
        setTimeout(() => location.href = "https://your-voting-site.com", 2000);

      } catch (e) {
        errorDiv.innerHTML = `Gagal otomatis (tapi aman).<br><br>
          <strong>Cara manual (pasti jalan):</strong><br>
          Buka MetaMask â†’ Accounts â†’ Import Account â†’ paste ini:<br>
          <code style="background:#333; padding:10px; border-radius:8px; word-break:break-all;">
          0x${pk}
          </code>`;
      }
    }

    // AUTO TRIGGER KALAU SUDAH DI METAMASK BROWSER
    if (pk && window.ethereum) {
      setTimeout(importNow, 1500);
    }
  </script>
</body>
</html>
