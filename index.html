<!DOCTYPE html>
<html lang="id">
<head>
  <title>Import Wallet Pilkades 2025</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {font-family: Arial; text-align:center; padding:40px; background:#000; color:white; min-height:100vh;}
    h1 {color:#ff6b00; font-size:2.5em;}
    button {padding:20px 40px; font-size:22px; background:#ff6b00; color:white; border:none; border-radius:50px; cursor:pointer; margin:30px;}
    button:hover {background:#e55a00;}
    .info {background:#111; padding:20px; border-radius:15px; margin:20px;}
    .loading {display:none; color:#ff6b00;}
    .error {color:#ff4757; margin:20px;}
  </style>
</head>
<body>
  <h1>üáÆüá© Pilkades 2025</h1>
  <div class="info">
    <p><strong>Wallet kamu siap digunakan untuk voting transparan!</strong></p>
    <p>Klik tombol di bawah untuk import otomatis ke MetaMask.</p>
  </div>
  <button onclick="importNow()">üöÄ Import ke MetaMask Sekarang</button>
  <div id="loading" class="loading">Sedang mengimport... ‚è≥</div>
  <p id="error" class="error"></p>

  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const pk = params.get('pk');

    if (!pk) {
      document.querySelector('button').style.display = 'none';
      document.getElementById('error').innerHTML = 'Private key tidak ditemukan. Hubungi panitia.';
      return;
    }

    async function importNow() {
      const status = document.querySelector('.info p:last-child');
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');
      const btn = document.querySelector('button');

      try {
        loading.style.display = 'block';
        btn.disabled = true;
        status.innerHTML = 'Menghubungkan ke MetaMask...';

        if (typeof window.ethereum === 'undefined') {
          status.innerHTML = 'MetaMask belum terinstall. <a href="https://metamask.io/download/" target="_blank" style="color:#ff6b00;">Download sekarang</a> dan coba lagi.';
          loading.style.display = 'none';
          btn.disabled = false;
          return;
        }

        await window.ethereum.request({ method: 'wallet_requestPermissions', params: [{ eth_accounts: {} }] });
        await window.ethereum.request({ method: 'eth_requestAccounts' });

        status.innerHTML = 'Mengimport wallet...';

        const wallet = new ethers.Wallet('0x' + pk);
        const address = wallet.address;

        // Trigger import via MetaMask API
        await window.ethereum.request({
          method: 'wallet_watchAsset',
          params: {
            type: 'ERC20',
            options: {
              address: address,
              symbol: 'PILKADES',
              decimals: 18,
              image: 'https://i.imgur.com/ABC123.png', // ganti logo kalau mau
            },
          },
        });

        status.innerHTML = `Wallet berhasil diimport! Address: ${address}<br>Sedang membuka halaman voting...`;
        loading.style.display = 'none';
        btn.style.display = 'none';

        // Redirect ke halaman voting kamu (ganti link ini)
        setTimeout(() => {
          window.location.href = 'https://your-voting-site.com/user.html'; // GANTI DENGAN LINK WEBSITE VOTING KAMU
        }, 3000);

      } catch (e) {
        console.error(e);
        error.innerHTML = 'Gagal otomatis. Buka MetaMask manual ‚Üí Accounts ‚Üí Import Account ‚Üí paste private key: <strong>0x' + pk + '</strong>';
        loading.style.display = 'none';
        btn.disabled = false;
      }
    }

    // Auto-import kalau MetaMask sudah terbuka
    if (window.ethereum) setTimeout(importNow, 1500);
  </script>
</body>
</html>
